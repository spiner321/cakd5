1p. 
안녕하세요 cakd5 데이터 어셈블팀, 
구매 감소고객 예측 모델을 통한 마케팅 솔루션 제안 발표를 시작하겠습니다. 

2p 발표는 데이터 분석, 데이터 분석을 통해 도출된 과제 정의, 과제를 해결하기 위한 머신러닝 활용, 마지막으로 고객별 적합한 마케팅 제언 순으로 진행하겠습니다. 

4p 우선 데이터 분석 목적에 대해 설명해드리겠습니다.  
저희는 유통사 고객의 2년 간 소비 활동 데이터를 활용하여 고객의 소비 패턴을 파악하고 
패턴 분석을 통해 분류된 고객의 유형별로 니즈를 해결할 수 있는 마케팅을 제언하는 것을 목적으로 삼았습니다. 
이를 위해 활용한 데이터로는 유통기업 4개의 제휴사의 구매 이력과 
고객 성향을 파악할 수 있는 데이터 입니다. 
분석은 파이썬과 sql을 사용하여 주피터, 코렙, 오라클에서 분석을 시행하였습니다. 

5p 2014년과 2015년의 매출액을 살펴보았을 때 5.41%가 증가한 것을 알 수 있었습니다. 
분기별로 살펴보았을 때도 2015년 모든 분기의 매출액이 2014년보다 높을 것을 확인할 수 있었습니다. 

6p 2014년 대비 2015년의 총매출이 증가한 것을 확인한 뒤, 
속성별로 데이터를 시각화하여 매출에 영향을 주는 요인을 분석해보았습니다. 
성별, 제휴사 4곳, 거주지역, 연령대별로 나눠서 분석해보았지만 매출에 영향을 준다는 뚜렷한 요인을 확인할 수 없었습니다. 

8p 따라서 고객별로 분석을 해보기로 하였습니다. 
유통업계에서 일반적으로 고객을 나눌 때 분기별로 파악하기 때문에 
2014년, 2015년을 각각 4분기씩 8개의 분기로 나누어서 고객별 구매 이력을 살펴보게 되었습니다. 
저희는 8분기 내내 구매가 지속되는 고객을 고정고객이라고 정의하고 
8분기 동안 구매가 한 번이라도 끊기는 고객은 비고정 고객이라고 정의내렸습니다. 

비고정고객과 고정고객의 매출 평균을 살펴보았을 때 비고정 고객의 평균 매출액이 52%로 약간 더 많았습니다. 
하지만 고정고객이 인구 대비 매출 합계가 더 높았기 때문에 고정고객을 대상으로 분석하기로 결정하였습니다. 

9p
고정고객 중에서 매출액이 상승한 고객과 감소한 고객을 살펴보기 위해서 고객을 정의하였습니다. 
계절성을 제거한 매출액에서 1분기 대비 8분기 매출이 감소한 고객을 감소고객으로, 그 외의 고객은 증가고객으로 정의하였습니다. 

전체 고정고객 18866명 중 감소고객은 10258명으로 54.37%를 차지하고 있습니다. 

10p 고정고객의 매출액을 살펴보면 4.5% 상승으로 문제가 없는 듯 보이지만 
감소고객의 매출액을 살펴보면 1분기 대비 8분기 30%나 감소되어 157억원이나 매출 하락이 발생하였습니다. 
만약 감소고객이 8분기에 적어도 1분기만큼의 구매를 유지했을 경우 
저희는 고정고객에게서 4.5% 매출액 상승이 아닌 23.7% 매출액 상승을 기대할 수 있습니다. 

11p 따라서 구매감소고객을 예측하고 방지하는 것이 시급한 사항이라 판단하였고 
고객의 pain point에 사전대응할 수 있는 구매 감소고객 예측모델을 만드는 것을 과제로 정의하였습니다. 

12p . 과제 해결 과정은 다음과 같습니다. 
(step1 :) 
데이터 분석을 통해 종속변수와 독립변수를 창출하고 완성된 데이터 셋으로 다양한 분류 알고리즘을 사용해 머신러닝을 진행 하여 구매감소고객 예측을 위한 분류모델 구현을 합니다.  

(step2 :) 다음은 분류모델을 통해 구매감소로 예측된 고객을 KMeans를 이용하여 군집화를 한뒤
(step3 :) 군집화된 집단에 따라 맞춤 솔루션을 제공합니다.

(step4 :) 그리고 군집화된 집단 중 구매력이 높은 고객 군집 대상으로 아이템기반 최근접 이웃 협업 필터링을 이용하여 개인화 상품 추천을 합니다.  

13p. 
예측 모델을 만들기 위한 분석에 앞서 제휴사별 상품 분류가 각각 다르기 때문에 통합된 분류가 필요합니다. 
유통상품지식뱅크를 참고하면서 14가지 카테고리로 통합된 분류체계를 마련 했으며, 
소비자 구매행동 특성에 따라 편의품,선매품, 전문품으로 통합하였습니다.

14p. 
다음은 독립변수로 발굴하기 위해 카테고리화를 할 수 있는 피쳐들을 찾아 
기준을 새로 정하여 연령대와, 지역, 구매시간대를 재카테고리화 하였습니다. 

15p.
분류 모델은 지도 학습으로서 정답 값이 필요합니다.
따라서 1기 -6기를 학습 데이터로 7기를 정답 데이터로 하여 훈련을 시키고 
훈련된 모델을 가지고 1기와 7기를 학습 데이터로 하여 8기를 실제로 예측해보기로 하였습니다.

이 때 사용된 종속변수는
학습, 검증용을 1분기 대비 7분기 구매감소유무로 정의하였고,
테스트용을 1분기 대비 8분기 구매감소유무로 정의하였습니다.

그리고 독립변수는
학습, 검증용을 1분기~6분기의 데이터를 사용하였고,
테스트용을 1분기~7분기의 데이터를 사용하였습니다.

16p 
독립변수로 쓰이는 변수는 고객 속성변수와 구매 패턴 변수로 나뉩니다. 다음은 고객 속성을 표현하는 변수입니다. 

17p 
다음은 구매 패턴 변수입니다. 
구매 패턴 변수는 크게 구매지수와 방문지수로 나뉩니다. 

18p 
구매 패턴 변수를 지수화 하는 방법입니다. 
고객은 각 분기별 구매액에 따라 1~10등급 중 하나의 등급을 부여받습니다. 
등급 변동의 절댓값의 합산인 변동폭과 마지막 분기와 첫 분기 등급의 차인 증감폭을 각각 가중치를 곱해준 뒤 두 값을 더하여 구매지수를 구합니다. 

19p 3장에서는 변수를 활용한 머신러닝 활용부분에 대해서 발표하겠습니다. 

20p 디시즌 트리, 랜덤 포레스트, 로지스틱 레그레션, xgboost, lightGBM을 써서 분류 모델 별 정확도를 측정했을 때 랜덤 포레스트 모델와 XG부스트 모델에서 높은 값을 얻을 수 있었습니다.

21p  
따라서 두 모델을 그리드 서치 시비를 통해 교차검증을 수행해보았고 최적의 파라미터로 학습한 뒤 랜덤 포레스트 모델을 사용하기로 최종 결정하였습니다. 

22p
감소라고 예측된 7248명을 대상으로 랜덤 포레스트에서 중요하다고 나온 상위 20개 변수만 뽑아 군집화를 수행하였고 
실루엣 계수와 분포도를 참고해 최종 군집 수는 3개로 결정하였습니다.

23p
3개의 군집 중 구매력이 높다고 판단된 고객을 대상으로 추천시스템을 진행할 예정입니다. 
파이썬 기반 추천시스템을 위한 패키지인 서프라이즈를 이용해 행렬분해 기반 잠재요인 협업 필터링을 수행합니다. 
고객 번호를 입력받아 1단계로 소비재 제품군을 추천받고 2단계로 카테고리를 추천받은 뒤 최종적으로 가격대에 따른 상품유형을 추천합니다. 

24p
4장에서는 앞서 군집화된 고객의 특징을 파악해 제안한 마케팅 솔루션에 대해서 말씀드리겠습니다.

25p
구매 감소가 예측된 고객은 군집1에 3014명, 군집2에 2374명, 군집 3에 1860명이 할당됩니다. 
군집 1은 가장 고객 수가 많은 군집으로 특히 중년층의 인구 비중이 높았습니다.
군집 2는 두 번째로 고객 수가 많은 군집이지만 총 매출액은 가장 작은 군집입니다. 
군집 3은 타 군집 대비 선매품과 전문품의 비중이 높아 구매력이 높다고 판단 되었고, 
1분기 대비 8분기 매출액의 감소폭이 군집 1, 2에 비해 낮아 높은 수 ROI가 예상되어 이 군집을 대상으로 개인화 상품 추천시스템을 진행하고자 하였습니다. 

26p 
앞서 말씀드린 군집에 대해서 마케팅 제언을 하겠습니다. 
고객 군집 1은 B 제휴사를 이용하는 중년층에서 구매감소가 두드러지게 보였습니다. 
이 중 일상용품과 유아동품의 구매 감소가 급격한 것을 확인할 수 있어 구매를 향상시키기 위해 
가족 멤버십 카드를 발급 시 혜택을 제공하는 것을 솔루션으로 정하였습니다.

27p 
고객 군집 2에서는 노년층 고객의 패션잡화, 디지털/가전 카테고리에서의 구매감소가 이슈가 되었습니다. 
따라서 B 제휴사에서 브랜드 겨울 상품 시즌 오프 행사를 통하여 매출을 증대하고 
A 제휴사에서 디지털/가전에서 일정 금액 이상 구매한 고객에게 사은품 증정 행사 등을 하는 것 등으로 솔루션을 제공합니다.

28p 마지막으로 군집 3을 대상으로 개인화 상품 추천을 진행한 결과입니다. 
앞에서 설명해 드린것처럼 고객별로 소비재의 추천이 먼저 진행되었고 점차적으로 추천이 진행되었습니다. 
그 결과로는 해당 소비재마다 알맞은 카테고리와 상품분류가 들어가 있음을 확인할수 있었습니다.

29p 이상 구매감소고객 예측모델을 통한 마케팅 솔루션 제안에 관한 발표를 마치도록 하겠습니다.

















--------------------------------------------------------------------
데이터 속성 설명 +

제휴사별 카테고리 통합 
	1-1) 카테고리 재분류 (14개) 
	1-2) 편의품, 선매품, 전문품)

2p. 분석 언어, 툴 : 파이썬, sql, 주피터노트북, 오라클
(경수)
--------------------------------------------------------------------------------------------------------
3p. 전체 매출 증가를 확인 후, 탐색적 데이터 분석 속성별로 증가요인 분석 > 뚜렷하게 매출에 영향을 주는 요인을 확인할 수 없었음

4p. 속성별로 매출에 영향을 준 요인을 분석할 수 없어 고객을 그룹별로 나누어 분석해보기로 판단 
-------------------------------------------------------------------------------------------------------
5p. 유통업계에서 일반적으로 고객을 나눌 때 분기별로 파악하기 때문에 (2014년, 2015년) 8분기로 나누어서 고객별로 구매 이력을 살펴보게 됨 -> 그 중 8분기 내내 구매가 지속되는 고객을 고정고객이라고 정의함
 
6p. 실제 고정고객과 비고정고객의 인구수와 매출액을 비교했을 때 비고정고객의 인구수 대비 매출액이 차지하는 비율이 더 낮아서 고정고객을 분석하기로 결정 (이에 더불어 분석을 위해서는 끊기는 구간 없이 8분기 내내 구매이력이 있는 고정고객의 매출을 살펴보는 것이 맞다고 생각을 하고)

비기존고객과 고정고객의 매출 평균을 살펴보았을 때 비기존 고객의 평균 매출액이 차지하는 비중이 52%로 약간 더 많긴 했지만 비슷하였기 때문에 고객수와 매출합계를 살펴보았습니다. 기존 고객과 비기존 고객을 비교해 보았을 때 기존 고객의 수가 비기존고객에 비해 압도적으로 많았다. 또한 기존고객이 차지하는 총매출액은 인구수보다 더 많은 99%에 다달았다. 따라서 기존고객을 대상을 분석을 진행하고 마케팅 솔루션을 제공하기로 결정하였다.

7p. 고정고객 중에서 매출액이 상승한 고객과 감소한 고객을 살펴봄 
-> 고객 감소를 정의 : '마지막 기수와 첫기수의 매출을 비교했을 때 0보다 작은 고객' 

-> 왜 고객감소를 마지막 기수와 첫기수로 비교를 했는지?? 어차피 계절성을 제거했기 때문에 어떤 기수를 선택해도 상관없지만 추후 분석을 위해서는 고객의 패턴 데이터가 필요했기 때문에 처음과 마지막의 매출액을 비교해서 구매증가와 감소고객을 정의하게 되었음   
+ 첫기수와 마지막 기수의 매출액을 비교해 정의내린 고객들의 구매 패턴을 살펴보았을 때 증가고객은 증가하는 패턴을, 감소하는 고객은 감소하는 패턴을 보여줬음 

8p. (여기서 매출액은 시즈널리티를 제거하고 비교함) 시즈널리터 왜 제거? 연도가 아닌 분기별로 나눴기 때문에 매출액을 비교하려면 각각 분기마다 두드러지는 계절성을 제거해야지 분석이 가능하기 때문이다. 

9p. 감소한 고객들이 만약 매출을 유지했을 경우 기업이 추가적으로 벌어들일 수 있는 금액은? 고정고객의 매출액 중 33%! 
--------------------------------------------------------------------------------------------------------
(성윤)
10p. 문제 정의 : 감소 고객을 미리 예측하고 기업에서 사전 대응을 한다면 더 큰 매출액 상승을 불러올 수 있을 것이라고 판단
--------------------------------------------------------------------------------------------------------
12p. 재카테고리화 
	1) 고객 연령대 (10개 -> 5개) (시각이미지) 
	2) 지역 (41개 -> 17개) 
	3) 시간대 (24시)->
	(5구간) 0-8시 새벽 8-12시 오전 12-17시 오후 
		 17-20시 저녁 20-0시 야간 (시각이미지) 

13p. 과제 해결 과정은 다음과 같습니다. 예측을 위한 분류모델 구현 -> 군집화 -> 군집별 마케팅 제언-> 개인화 상품 추천 

14p. 데이터셋 분리
분류 모델은 지도 학습으로서 정답 값이 필요함 
따라서 1기 -6기를 학습 데이터로 7기를 정답 데이터로 하여 훈련을 시키고 훈련된 모델을 가지고 1기와 7기를 학습 데이터로 하여 8기를 실제로 예측해보기로 하였다

분류를 위해 데이터를 학습-검증용과 테스트용으로 나눠야했음
데이터는 1기 8기밖에 없으니까 8기는 테스트에 쓸 종속변수로 분리
따라서 1기에서 7기 데이터로 8기의 고객 증감을 예측하고 실제 데이터와 비교해서 모델의 정확도를 판단 
학습을 위해선 1기에서 6기 데이터를 패턴 파악을 위한 데이터로 쓰고 7기를 종속변수로 분리 
-------------------------------------------------------------------------------------------------------
(기현)
15p. 결정된 피처들 
지수화 방법 : 증감과 변동 증감은 마지막기수와 첫번째 기수의 차이 변동은 각 분기의 변동의 절댓값의 합 

고객속성변수 (원래 9개)
1 CAT연령대 
2 지역
3 경쟁사이용횟수
4 채널이용횟수  
5 RECENCY6
6 주말구매액비중 

변동변수 (28 + 2 + 8)  38개 + 25개
 6   분기_count지수   
 7   A_sum지수     
 8   D_sum지수        
 9   B_count지수      
 10  C_count지수      
 11  의약품/의료기기_구매지수
 12  교육/문화용품_구매지수   
 13  외식_구매지수     
 14  기타_구매지수       
 15  디지털/가전_구매지수    
 16  가구/인테리어_구매지수   
 17  의류_구매지수       
 18  전문스포츠/레저_구매지수
 19  패션잡화_구매지수      
 20  명품_구매지수    
 21  가공식품_방문지수     
 22  신선식품_방문지수      
 23  일상용품_방문지수      
 24  전문스포츠/레저_방문지수  
 25  유아동_방문지수       
 
저희가 변수로 뽑은 것들은 72개 였는데 최종적으로 결정된 변수들은 26개입니다. 

15p. 다음은 변수를 활용하여 분류모델을 돌린 결과 입니다. 
결과 값이 가장 높은 친구들은 rf, lgbm 

16p. rf를 써서 구매 감소라고 예측된 고객들을 특성에 따라 3개로 군집화함
--------------------------------------------------------------------------------------------------------
(광민)
17p. 추천 모델 (knn,svd 하이브리드) 누구에게 어떤거 추천해주는지
 
18p. 고객 군집별 마케팅 제언

19p. 고객 개개인에 맞는 1개의 상품 추천 

20p. 



1. 분기별 매출액 비교 
(2. 나눈 고객별로 매출액 분석 (기존, 복귀, 이탈, 등등) - 안해도 될듯)

한정된 마케팅 비용 어디에 투자하는 게 더 이득일까?? 
-> 기존고객 중 감소고객에 투자하는 게 더 이득! 
2. 대신 기존고객과 비기존고객에서 설명 확실히 해주기 
- 구매 감소고객의 전체 매출액 

3. 영향력? 





5. 분류 모델링 시 필요한 변수 도출
1) 고객 속성변수
2) 구매 변동변수 : 1기에서 6기까지 변동한 값을 하나의 수치로 바꿔줄 필요가 있음 
어떻게?? 안 정함 
3) 구매 증감변수 : 

UPDATE 채경멤
SET 멤버십가입개수 = 1
WHERE 멤버십가입개수 > 1 

